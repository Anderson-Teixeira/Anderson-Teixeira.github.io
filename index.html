<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Adium</title>
    <style>
        /* Esconde o botão original do Embedded Service */
        .embeddedServiceHelpButton { display: none !important; visibility: hidden !important; }
        
        /* Container do botão de chat personalizado */
        .botao-chat-container {
          position: fixed;
          bottom: 30px;
          right: 30px;
          z-index: 999;
          display: flex;
          align-items: center;
          gap: 10px;
        }

        /* Estilo do balão de mensagem */
        .chat-balloon {
          background: #fff;
          padding: 12px 20px;
          border-radius: 20px;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
          font-family: Arial, sans-serif;
          font-size: 14px;
          color: #333;
          border: 1px solid #e0e0e0;
          animation: fadeIn 0.3s ease-in-out;
        }

        /* Seta do balão */
        .chat-balloon::after {
          content: '';
          position: absolute;
          right: -10px;
          top: 50%;
          transform: translateY(-50%);
          border-left: 10px solid #fff;
          border-top: 8px solid transparent;
          border-bottom: 8px solid transparent;
        }

        /* Classe para esconder o balão */
        .hidden {
          display: none;
        }

        /* Animação de entrada do balão */
        @keyframes fadeIn {
          from { opacity: 0; transform: translateX(-20px); }
          to { opacity: 1; transform: translateX(0); }
        }

        /* Estilo do botão de chat */
        .botao-chat {
          display: flex;
          align-items: center;
          justify-content: center;
          background: linear-gradient(to right, #ff0000, #e60000);
          width: 55px;
          height: 55px;
          border-radius: 50%;
          cursor: pointer;
          box-shadow: 0 2px 12px rgba(255, 0, 0, 0.2);
          transition: all 0.3s ease;
          border: none;
        }
        .botao-chat:hover { transform: scale(1.1); }
        .botao-chat:disabled { background: #ffcccc; cursor: not-allowed; }
        
        /* Classe para o estado de carregamento */
        .botao-chat.loading .chat-img {
          display: none;
        }
        
        .botao-chat.loading .loading-indicator {
          display: block;
        }

        /* Indicador de carregamento */
        .loading-indicator {
          display: none;
          width: 24px;
          height: 24px;
          border: 3px solid rgba(255, 255, 255, 0.3);
          border-radius: 50%;
          border-top-color: white;
          animation: spin 1s infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Conteúdo da página */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #0056b3;
            color: white;
            padding: 20px 0;
            text-align: center;
        }
        .content {
            background-color: white;
            padding: 30px;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px 0;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Bem-vindo ao Chat de Suporte</h1>
        </div>
    </header>
    
    <div class="container">
        <div class="content">
            <h2>Como podemos ajudar?</h2>
            <p>Utilize nosso chat online para falar com um dos nossos atendentes. Estamos à disposição para ajudar com suas dúvidas.</p>
            <p>Para iniciar uma conversa, clique no ícone de chat que aparece no canto inferior direito da tela.</p>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Adium. Todos os direitos reservados.</p>
        </div>
    </footer>

    <!-- Botão de chat personalizado -->
    <div class="botao-chat-container">
        <div id="chatBalloon" class="chat-balloon">Como posso ajudar?</div>
        <button id="botaoChat" class="botao-chat" onclick="ChatApp.iniciar()">
            <div class="loading-indicator"></div>
            <img src="images/Adium Logo vermelho.png" alt="Logo Adium" class="chat-img">
        </button>
    </div>

    <script>
        const ChatApp = (() => {
            const config = {
                scriptUrl: 'https://adiumbr--devchatbot.sandbox.my.site.com/ESWChatAdiumGitHubPages1740412245405/assets/js/bootstrap.min.js',
                orgId: '00DVA000001eH3B',
                componentName: 'ChatAdium_GitHubPages',
                deploymentUrl: 'https://adiumbr--devchatbot.sandbox.my.site.com/ESWChatAdiumGitHubPages1740412245405',
                scrtUrl: 'https://adiumbr--devchatbot.sandbox.my.salesforce-scrt.com',
                maxTentativas: 5,
                intervalo: 2000
            };
            
            let tentativas = 0;
            let carregando = false;
            let inicializado = false;
            
            const botao = document.getElementById('botaoChat');
            const balao = document.getElementById('chatBalloon');

            const setCarregando = (estado) => {
                carregando = estado;
                botao.classList.toggle('loading', estado);
                botao.disabled = estado;
                if (estado) {
                    balao.classList.add('hidden');
                }
            };
            
            const verificarAPIDisponivel = () => typeof embeddedservice_bootstrap !== 'undefined' &&
                                                embeddedservice_bootstrap.utilAPI &&
                                                typeof embeddedservice_bootstrap.utilAPI.launchChat === 'function';

            const carregarScript = () => {
                if (document.getElementById('bootstrap-script')) {
                    console.warn("Script já carregado, ignorando novo carregamento.");
                    return;
                }

                console.log("Carregando script do chat...");
                const script = document.createElement('script');
                script.id = 'bootstrap-script';
                script.type = 'text/javascript';
                script.src = config.scriptUrl;
                script.onload = () => {
                    console.log("Script carregado com sucesso.");
                    setTimeout(configurarChat, 1500);
                };
                script.onerror = () => {
                    console.error("Erro ao carregar o script do chat.");
                    alert('Erro ao carregar o chat.');
                };
                document.head.appendChild(script);
            };

            const configurarChat = () => {
                if (!verificarAPIDisponivel()) {
                    console.warn("API do chat não disponível, tentando novamente...");
                    setTimeout(configurarChat, 2000);
                    return;
                }

                console.log("Inicializando chat...");
                try {
                    embeddedservice_bootstrap.settings.language = 'pt_BR';
                    embeddedservice_bootstrap.init(
                        config.orgId,
                        config.componentName,
                        config.deploymentUrl,
                        { scrt2URL: config.scrtUrl }
                    );

                    if (embeddedservice_bootstrap.utilAPI) {
                        embeddedservice_bootstrap.utilAPI.addEventHandler('afterInit', () => {
                            console.log("Chat inicializado com sucesso.");
                            inicializado = true;
                            setCarregando(false);
                        });

                        embeddedservice_bootstrap.utilAPI.addEventHandler('afterDestroy', () => {
                            console.log("Chat encerrado.");
                            inicializado = false;
                            balao.classList.remove('hidden');
                        });
                    }
                } catch (err) {
                    console.error('Erro ao inicializar Embedded Messaging: ', err);
                }
            };

            const iniciar = () => {
                if (carregando) return;
                setCarregando(true);
                
                if (verificarAPIDisponivel()) {
                    console.log("Lançando chat...");
                    embeddedservice_bootstrap.utilAPI.launchChat()
                        .then(() => {
                            console.log("Chat iniciado com sucesso.");
                            inicializado = true;
                            setCarregando(false);
                        })
                        .catch((err) => {
                            console.error("Erro ao iniciar o chat:", err);
                            setCarregando(false);
                            alert('Erro ao iniciar o chat.');
                        });
                } else if (tentativas < config.maxTentativas) {
                    tentativas++;
                    console.warn(`Tentativa ${tentativas}/${config.maxTentativas} de iniciar o chat...`);
                    if (tentativas === 1 && !document.getElementById('bootstrap-script')) carregarScript();
                    setTimeout(iniciar, config.intervalo);
                } else {
                    tentativas = 0;
                    setCarregando(false);
                    console.error("O serviço de chat não está respondendo.");
                    alert('O serviço de chat não está respondendo.');
                }
            };

            window.addEventListener('load', () => {
                console.log("Página carregada, iniciando carregamento do script...");
                setTimeout(carregarScript, 1000);
            });

            return { iniciar };
        })();
    </script>
</body>
</html>
